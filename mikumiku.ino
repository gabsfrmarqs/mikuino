#include <LiquidCrystal.h>

// Define the connection pins between the Arduino and the LCD Display
const int rs = 12, en = 11, d4 = 5, d5 = 4, d6 = 3, d7 = 2;
LiquidCrystal lcd(rs, en, d4, d5, d6, d7);

int tonePin = 8; // The buzzer is connected to pin 8 of the Arduino

// Define a structure to hold note information
typedef struct {
  int frequency;
  int duration;
} Note;

// Array of notes for the melody
Note melody[] = {
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 349, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 349, 426 },
  { 415, 210 },
  { 523, 210 },
  { 554, 210 },
  { 698, 426 },
  { 415, 426 },
  { 622, 426 },
  { 415, 426 },
  { 349, 318 },
  { 554, 318 },
  { 415, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 277, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 233, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 426 },
  { 207, 426 },
  { 233, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 415, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 426 },
  { 207, 426 },
  { 184, 426 },
  { 349, 426 },
  { 207, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 415, 210 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 349, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 349, 426 },
  { 415, 210 },
  { 523, 210 },
  { 554, 210 },
  { 698, 426 },
  { 415, 426 },
  { 622, 426 },
  { 415, 426 },
  { 349, 318 },
  { 554, 318 },
  { 415, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 311, 318 },
  { 277, 426 },
  { 415, 210 },
  { 523, 210 },
  { 554, 210 },
  { 369, 426 },
  { 369, 426 },
  { 369, 210 },
  { 349, 210 },
  { 311, 210 },
  { 349, 637 },
  { 415, 426 },
  { 277, 210 },
  { 311, 210 },
  { 349, 426 },
  { 349, 426 },
  { 349, 426 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 637 },
  { 207, 426 },
  { 207, 210 },
  { 184, 210 },
  { 174, 426 },
  { 369, 426 },
  { 369, 426 },
  { 369, 210 },
  { 349, 210 },
  { 311, 210 },
  { 349, 637 },
  { 415, 426 },
  { 277, 210 },
  { 311, 210 },
  { 349, 426 },
  { 349, 426 },
  { 349, 426 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 1279 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 349, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 415, 318 },
  { 349, 426 },
  { 415, 210 },
  { 523, 210 },
  { 554, 210 },
  { 698, 426 },
  { 415, 426 },
  { 622, 426 },
  { 415, 426 },
  { 349, 318 },
  { 554, 318 },
  { 415, 426 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 466, 426 },
  { 277, 426 },
  { 415, 426 },
  { 277, 426 },
  { 261, 318 },
  { 311, 318 },
  { 277, 1064 },
  { 233, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 426 },
  { 207, 426 },
  { 233, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 415, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 233, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 426 },
  { 207, 426 },
  { 184, 426 },
  { 349, 426 },
  { 207, 426 },
  { 349, 426 },
  { 311, 210 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 415, 426 },
  { 523, 210 },
  { 554, 210 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 369, 215 },
  { 233, 103 },
  { 466, 103 },
  { 184, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 554, 103 },
  { 277, 215 },
  { 554, 103 },
  { 277, 103 },
  { 523, 103 },
  { 261, 103 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 369, 215 },
  { 233, 103 },
  { 466, 103 },
  { 184, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 554, 103 },
  { 277, 215 },
  { 554, 103 },
  { 277, 103 },
  { 523, 103 },
  { 261, 103 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 369, 215 },
  { 233, 103 },
  { 466, 103 },
  { 184, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 554, 103 },
  { 277, 215 },
  { 554, 103 },
  { 277, 103 },
  { 523, 103 },
  { 261, 103 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 466, 215 },
  { 233, 103 },
  { 369, 215 },
  { 233, 103 },
  { 466, 103 },
  { 184, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 415, 103 },
  { 207, 215 },
  { 554, 103 },
  { 277, 215 },
  { 554, 103 },
  { 277, 103 },
  { 523, 103 },
  { 261, 103 },
  { 369, 426 },
  { 369, 426 },
  { 369, 210 },
  { 349, 210 },
  { 311, 210 },
  { 349, 637 },
  { 415, 426 },
  { 277, 210 },
  { 311, 210 },
  { 349, 426 },
  { 349, 426 },
  { 349, 426 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 637 },
  { 207, 426 },
  { 207, 210 },
  { 184, 210 },
  { 174, 426 },
  { 369, 426 },
  { 369, 426 },
  { 369, 210 },
  { 349, 210 },
  { 311, 210 },
  { 349, 637 },
  { 415, 426 },
  { 277, 210 },
  { 311, 210 },
  { 349, 426 },
  { 349, 426 },
  { 349, 426 },
  { 349, 210 },
  { 311, 210 },
  { 277, 210 },
  { 261, 904 },
  { 277, 210 },
  { 349, 210 },
  { 415, 210 },
  { 932, 426 },
  { 554, 426 },
  { 830, 426 },
  { 554, 426 },
  { 523, 318 },
  { 830, 318 },
  { 698, 426 },
  { 554, 210 },
  { 698, 210 },
  { 830, 210 },
  { 932, 426 },
  { 554, 426 },
  { 830, 426 },
  { 554, 426 },
  { 523, 318 },
  { 830, 318 },
  { 698, 426 },
  { 830, 210 },
  { 1046, 210 },
  { 1108, 210 },
  { 1396, 426 },
  { 830, 426 },
  { 1244, 426 },
  { 830, 426 },
  { 698, 318 },
  { 1108, 318 },
  { 830, 426 },
  { 554, 210 },
  { 698, 210 },
  { 830, 210 },
  { 932, 426 },
  { 554, 426 },
  { 830, 426 },
  { 554, 426 },
  { 523, 318 },
  { 622, 318 },
  { 554, 1064 },
};
const int melodyLength = sizeof(melody) / sizeof(melody[0]); // Calculate melody length
int currentNote = 0;

// Protothread variables
unsigned long lastMillisMidi = 0; 
unsigned long lastMillisScreen = 0;

// Function to play a single note
void playNote(int frequency, unsigned long duration) {
  tone(tonePin, frequency);
  delay(duration); // Use delay for simplicity
  noTone(tonePin);
}

// Function to handle the melody playback
void playMelody() {
  if (currentNote < melodyLength) {
    playNote(melody[currentNote].frequency, melody[currentNote].duration);
    currentNote++;
  } else {
    currentNote = 0; 
  }
}

// Function to update the LCD screen
// idk why this didnt work with switch case
int i = 0;
void updateScreen() {
  lcd.setCursor(0, 0);
  if (i == 0){
    lcd.print("miku            ");
  }
  else if (i == 1){
    lcd.print("miku miku       ");
  } else if (i == 2){
    lcd.setCursor(0,1);
    lcd.print("ooo             ");
  }
  else if (i == 3){
    lcd.setCursor(0,1);
    lcd.print("ooo eee         ");
  }
  else if (i == 4){
    lcd.setCursor(0,1);
    lcd.print("ooo eee ooo     ");
  }
  else if (i == 5){
    lcd.clear();
    lcd.setCursor(0,0);
    lcd.print("miku            ");
  }
  i++;
  if (i == 6){
    i = 0;
  }
 // Increment the counter after the if-else chain
}

void setup() {
  pinMode(tonePin, OUTPUT);
  lcd.begin(16, 2);
  lcd.setCursor(0, 0);
  lcd.print("miku miku");
  lcd.setCursor(0, 1);
  lcd.print("ooo eee ooo");
  Serial.begin(9600);
}

void loop() {
  playMelody();
  updateScreen();
  delay(25); // Add a slight delay between updates
}